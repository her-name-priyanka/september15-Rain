<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Special Birthday Wish</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --glass-bg: rgba(0, 0, 0, 0.2);
            --glass-border: rgba(255, 255, 255, 0.2);
            --glow-color: rgba(255, 223, 186, 0.8); 
        }
        
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            font-family: 'Poppins', sans-serif;
            background-color: #0c0a1a;
        }
        
        #start-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0c0a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            z-index: 1000;
            cursor: pointer;
            transition: opacity 1s ease-out;
            opacity: 1;
        }
        #start-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        #start-overlay h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 3rem;
            margin: 0;
            text-shadow: 0 0 15px var(--glow-color);
        }
        #start-overlay p {
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            margin-top: 1rem;
            opacity: 0.8;
            letter-spacing: 1px;
            animation: pulse 2s infinite ease-in-out;
        }

        .scene {
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            width: 100%;
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            text-shadow: 0 0 10px black;
            transition: background-image 1.5s ease-in-out;
        }
        .scene h1 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            background: rgba(0,0,0,0.4);
            padding: 1rem 2rem;
            border-radius: 15px;
            text-align: center;
        }
        
        .scene-1 { background-image: url('./cafe.jpg'); }
        .scene-2 { background-image: url('./city.jpg'); }
        .scene-3 { background-image: url('./flower.jpg'); }
        .scene-4 { background-image: url('./pu.jpg'); }
        .scene-5 { background-image: url('./city3.jpg'); }
        .scene-6 { background-image: url('https://images.pexels.com/photos/2440024/pexels-photo-2440024.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=2'); }
        .scene-7 { background-image: url('./fest.jpg'); }
        .scene-8 { background-image: url('./night\ cafe.jpg'); }
        .scene-9 { background-image: url('./nature.jpg'); }
        .scene-10 { background-image: url('./ny.jpg'); }

        #main-heading {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            backdrop-filter: blur(8px);
            padding: 10px 30px;
            border-radius: 50px;
            color: white;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-family: 'Poppins', sans-serif;
            font-size: 1.2rem;
            font-weight: 700;
            text-shadow: 0 0 8px var(--glow-color);
            animation: fadeInDown 1.5s ease-out;
        }

        #rain-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; transition: transform 0.5s ease-in-out; }
        #rain-layer.tilted-rain .raindrop { animation-name: fall-tilted; }
        .raindrop { position: absolute; bottom: 100%; width: 1px; height: 50px; background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.4)); animation: fall linear infinite; }
        .raindrop.front { height: 80px; width: 2px; background: linear-gradient(to bottom, rgba(255, 255, 255, 0), rgba(255, 255, 255, 0.6)); animation-duration: 0.6s !important; }
        @keyframes fall { from { transform: translateY(0vh); } to { transform: translateY(110vh); } }
        @keyframes fall-tilted {
            from { transform: translate(-50vw, -10vh) rotate(-30deg); }
            to { transform: translate(50vw, 110vh) rotate(-30deg); }
        }

        #lightning-flash { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; opacity: 0; z-index: 12; pointer-events: none; }
        #lightning-flash.flash { animation: flash-effect 0.5s ease-out; }
        @keyframes flash-effect { 0%, 100% { opacity: 0; } 50% { opacity: 0.3; } 60% { opacity: 0; } 70% { opacity: 0.1; } }

        #rain-controls { position: fixed; top: 20px; right: 20px; background: rgba(0, 0, 0, 0.6); padding: 12px 15px; border-radius: 50px; z-index: 100; display: flex; align-items: center; gap: 15px; color: white; user-select: none; box-shadow: 0 4px 15px rgba(0,0,0,0.3); border: 1px solid rgba(255, 255, 255, 0.2); animation: fadeInRight 1.5s ease-out; }
        #rain-controls button { background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 30px; height: 30px; border-radius: 50%; font-size: 1.2rem; font-weight: bold; cursor: pointer; transition: background 0.2s; display: flex; justify-content: center; align-items: center; }
        #rain-controls button:hover { background: rgba(255, 255, 255, 0.4); }
        #rain-controls button:active { transform: scale(0.95); }
        #rain-level-display { font-size: 1rem; font-weight: bold; min-width: 80px; text-align: center; }

        #side-menu { position: fixed; top: 50%; left: 20px; transform: translateY(-50%); z-index: 101; display: flex; flex-direction: column; gap: 15px; animation: fadeInLeft 1.5s ease-out; }
        .menu-btn { background: var(--glass-bg); border: 1px solid var(--glass-border); width: 50px; height: 50px; border-radius: 50%; cursor: pointer; backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; transition: all 0.2s ease; }
        .menu-btn:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); box-shadow: 0 0 15px var(--glow-color); }
        .menu-btn svg { width: 24px; height: 24px; fill: white; }
        
        #scene-menu { position: fixed; top: 50%; right: 20px; transform: translateY(-50%); z-index: 101; display: flex; flex-direction: column; gap: 8px; animation: fadeInRight 1.5s ease-out; }
        .scene-btn { background: var(--glass-bg); border: 1px solid var(--glass-border); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; backdrop-filter: blur(8px); color: white; font-family: 'Poppins', sans-serif; font-weight: 700; display: flex; justify-content: center; align-items: center; transition: all 0.2s ease; font-size: 0.9rem; }
        .scene-btn:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }
        .scene-btn.active { background: rgba(255, 255, 255, 0.4); box-shadow: 0 0 15px var(--glow-color); transform: scale(1.1); }

        .glass-panel { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0); transform-origin: center; z-index: 102; background: var(--glass-bg); border: 1px solid var(--glass-border); border-radius: 20px; backdrop-filter: blur(10px); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); padding: 30px; color: white; width: 80%; max-width: 500px; opacity: 0; transition: transform 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28), opacity 0.4s ease; pointer-events: none; }
        .glass-panel.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
        .panel-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 2rem; color: white; cursor: pointer; line-height: 1; opacity: 0.7; transition: opacity 0.2s; }
        .panel-close-btn:hover { opacity: 1; }
        .panel-header { font-family: 'Poppins', sans-serif; text-align: center; margin-bottom: 20px; font-size: 1.8rem; font-weight: 700; text-shadow: 0 0 10px var(--glow-color); }

        #music-player-controls { display: flex; justify-content: center; align-items: center; gap: 20px; margin: 20px 0; }
        #music-player-controls button { background: none; border: 2px solid white; color: white; width: 45px; height: 45px; border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.2s; }
        #music-player-controls button:hover { background: var(--glass-border); }
        #play-pause-btn svg { width: 20px; height: 20px; }
        #progress-container { width: 100%; height: 8px; background: rgba(0,0,0,0.3); border-radius: 5px; cursor: pointer; margin: 10px 0; }
        #progress-bar { width: 0%; height: 100%; background: white; border-radius: 5px; }
        #track-info { text-align: center; }
        #wishes-content { font-style: italic; text-align: center; font-size: 1.2rem; line-height: 1.6; }
        
        #video-player { 
            width: 100%; 
            aspect-ratio: 16 / 9; 
            border-radius: 10px; 
            border: none; 
        }

        .lantern { position: fixed; bottom: -100px; width: 40px; height: 60px; border-radius: 45% 45% 10px 10px; opacity: 0.9; filter: blur(3px); animation: floatUp 20s linear infinite; pointer-events: none; z-index: 11; }
        @keyframes floatUp { to { bottom: 110vh; transform: scale(1.2) translateX(var(--x-drift)); } }
        .lantern.red { background: radial-gradient(circle at 50% 50%, #ff5252, #c62828); }
        .lantern.blue { background: radial-gradient(circle at 50% 50%, #448aff, #1565c0); }
        .lantern.green { background: radial-gradient(circle at 50% 50%, #69f0ae, #00796b); }
        .lantern.purple { background: radial-gradient(circle at 50% 50%, #e040fb, #7b1fa2); }
        .lantern.yellow { background: radial-gradient(circle at 50% 50%, #ffff8d, #f9a825); }

        #rainbow-effect {
            position: fixed;
            top: -85vh; 
            left: -50vw;
            width: 200vw;
            height: 200vw; 
            background: radial-gradient(
                circle,
                transparent 40%,
                rgba(255, 0, 0, 0.35) 40.5%,   
                rgba(255, 165, 0, 0.35) 41%,  
                rgba(255, 255, 0, 0.35) 41.5%,    
                rgba(0, 255, 0, 0.35) 42%,     
                rgba(0, 0, 255, 0.35) 42.5%,  
                rgba(75, 0, 130, 0.35) 43%,   
                rgba(238, 130, 238, 0.35) 43.5%, 
                transparent 44%
            );
            border-radius: 50%;
            z-index: 5;
            pointer-events: none;
            opacity: 0;
            transition: opacity 2.5s ease-in-out;
        }

        #rainbow-effect::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: radial-gradient(
                circle,
                transparent 45.5%, 
                rgba(238, 130, 238, 0.2) 46%,
                rgba(75, 0, 130, 0.2) 46.5%,
                rgba(0, 0, 255, 0.2) 47%,
                rgba(0, 255, 0, 0.2) 47.5%,
                rgba(255, 255, 0, 0.2) 48%,
                rgba(255, 165, 0, 0.2) 48.5%,
                rgba(255, 0, 0, 0.2) 49%,
                transparent 49.5%
            );
        }
        
        #rainbow-effect.visible {
            opacity: 1; 
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translate(-50%, -30px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
        @keyframes fadeInLeft {
            from { opacity: 0; transform: translate(-30px, -50%); }
            to { opacity: 1; transform: translate(0, -50%); }
        }
        @keyframes fadeInRight {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }

    </style>
</head>
<body>

    <div id="start-overlay">
        <h1>Happy Birthday Priyankaaa 💫</h1>
        <p>Let the rain wash your silence, and the wind carry your dreams.</p>
    </div>

    <div id="main-heading" style="visibility: hidden;">
        Raindrops, Dreams, and a Birthday to Remember
    </div>
    <div id="rain-layer"></div>
    <div id="lightning-flash"></div>
    <div id="rainbow-effect"></div>

    <div id="rain-controls" style="visibility: hidden;">
        <button id="decrease-rain" title="Decrease Rain">-</button>
        <span id="rain-level-display"></span>
        <button id="increase-rain" title="Increase Rain">+</button>
    </div>
    
    <div id="side-menu" style="visibility: hidden;">
        <button class="menu-btn" data-panel="wishes-panel" title="Birthday Wishes"><svg viewBox="0 0 24 24"><path d="M20,8L12,13L4,8V6L12,11L20,6M20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4Z"></path></svg></button>
        <button class="menu-btn" data-panel="music-panel" title="Music Player"><svg viewBox="0 0 24 24"><path d="M12,3V13.55A4,4 0 0,0 10,13A4,4 0 1,0 14,17V7H18V3H12Z"></path></svg></button>
        <button class="menu-btn" data-panel="video-panel" title="Rainy Day Video"><svg viewBox="0 0 24 24"><path d="M10,16.5V7.5L16,12M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"></path></svg></button>
        <button class="menu-btn" id="rainbow-btn" title="Show Rainbow"><svg viewBox="0 0 24 24"><path d="M12,2A9,9 0 0,0 3,11H5.1A7,7 0 0,1 12,4A7,7 0 0,1 19,11H21A9,9 0 0,0 12,2M3,12H5A7,7 0 0,1 12,19A7,7 0 0,1 19,12H21A9,9 0 0,0 12,21A9,9 0 0,0 3,12M12,6A5,5 0 0,0 7,11H9A3,3 0 0,1 12,8A3,3 0 0,1 15,11H17A5,5 0 0,0 12,6Z"></path></svg></button>
        <button class="menu-btn" id="celebrate-btn" title="Celebrate!"><svg viewBox="0 0 24 24"><path d="M19,9V5A2,2 0 0,0 17,3H7A2,2 0 0,0 5,5V9H2V11H5V15H2V17H5V21H7V17H17V21H19V17H22V15H19V11H22V9H19M17,15H7V11H17V15Z"></path></svg></button>
    </div>

    <div id="scene-menu" style="visibility: hidden;">
        <button class="scene-btn" data-scene="1">1</button>
        <button class="scene-btn" data-scene="2">2</button>
        <button class="scene-btn" data-scene="3">3</button>
        <button class="scene-btn" data-scene="4">4</button>
        <button class="scene-btn" data-scene="5">5</button>
        <button class="scene-btn" data-scene="6">6</button>
        <button class="scene-btn" data-scene="7">7</button>
        <button class="scene-btn" data-scene="8">8</button>
        <button class="scene-btn" data-scene="9">9</button>
        <button class="scene-btn" data-scene="10">10</button>
    </div>

    <div id="wishes-panel" class="glass-panel"><button class="panel-close-btn">&times;</button><h2 class="panel-header">A Birthday Wish for You</h2><p id="wishes-content">A special message...</p></div>
    <div id="music-panel" class="glass-panel"><button class="panel-close-btn">&times;</button><div id="track-info"><h3 class="panel-header">A Birthday Soundtrack</h3><p id="track-artist"></p></div><div id="progress-container"><div id="progress-bar"></div></div><div id="music-player-controls"><button id="prev-btn"><svg viewBox="0 0 24 24"><path d="M6,18V6H8V18H6M9.5,12L18,6V18L9.5,12Z"></path></svg></button><button id="play-pause-btn"><svg id="play-icon" viewBox="0 0 24 24"><path d="M8,5.14V19.14L19,12.14L8,5.14Z"></path></svg><svg id="pause-icon" viewBox="0 0 24 24" style="display:none;"><path d="M14,19H18V5H14M6,19H10V5H6V19Z"></path></svg></button><button id="next-btn"><svg viewBox="0 0 24 24"><path d="M16,18H18V6H16M6,18L14.5,12L6,6V18Z"></path></svg></button></div></div>
    
    <div id="video-panel" class="glass-panel"><button class="panel-close-btn">&times;</button><h2 class="panel-header">A Moment of Calm</h2>
        <iframe 
            id="video-player" 
            src="https://www.youtube.com/embed/J4d-a7dVtiQ" 
            title="Close Your Eyes and Feel the Rain 😴" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
            referrerpolicy="strict-origin-when-cross-origin" 
            allowfullscreen>
        </iframe>
    </div>
    
    <div id="celebration-effects"></div>

    <audio id="music-player"></audio>
    <audio id="fireworks-sound" src="https://cdn.pixabay.com/download/audio/2022/01/18/audio_f2c3d52763.mp3"></audio>
    <audio id="rain-sound" loop src="https://cdn.pixabay.com/download/audio/2022/08/04/audio_de3f8d3b5c.mp3"></audio>
    <audio id="thunder-sound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_51c68f44d1.mp3"></audio>

    <div id="background-scene" class="scene scene-1">
        <h1 id="scene-title">Whispers of Coffee and Drizzle</h1>
    </div>

    <script>
        const startOverlay = document.getElementById('start-overlay');
        const mainHeading = document.getElementById('main-heading');
        const rainControls = document.getElementById('rain-controls');
        const sideMenu = document.getElementById('side-menu');
        const rainSound = document.getElementById('rain-sound');
        const thunderSound = document.getElementById('thunder-sound');
        const backgroundScene = document.getElementById('background-scene');
        const sceneTitle = document.getElementById('scene-title');
        const sceneMenu = document.getElementById('scene-menu');
        const sceneButtons = document.querySelectorAll('.scene-btn');
        
        const sceneTitles = [
            "Whispers of Coffee and Drizzle",
            "Reflections of Color in the Midnight Rain",
            "Raindrops Resting on Velvet Blossoms",
            "When Strangers Share the Same Shelter",
            "A Grey Sky Painting Silver on the Water",
            "Beneath a Canopy of Celestial Dreams",
            "A Garden of Words",
            "The City Writes Its Secrets in Light",
            "When Nature Paints Beyond Imagination",
            "A Window to a Rainy World"
        ];

        const MAX_DROPS = 500;
        const RAIN_LEVELS = { 0: { label: 'None', count: 0, tilt: false }, 1: { label: 'Drizzle', count: 50, tilt: false }, 2: { label: 'Light Rain', count: 150, tilt: false }, 3: { label: 'Steady Rain', count: 300, tilt: false }, 4: { label: 'Heavy Rain', count: 400, tilt: true }, 5: { label: 'Downpour', count: MAX_DROPS, tilt: true }, };
        let currentRainLevel = 2;
        const raindrops = [];
        const rainLayer = document.getElementById('rain-layer');
        const decreaseBtn = document.getElementById('decrease-rain');
        const increaseBtn = document.getElementById('increase-rain');
        const levelDisplay = document.getElementById('rain-level-display');
        const lightningFlash = document.getElementById('lightning-flash');

        function createRainPool() {
            for (let i = 0; i < MAX_DROPS; i++) {
                const drop = document.createElement('div');
                const isFront = Math.random() > 0.7;
                drop.className = isFront ? 'raindrop front' : 'raindrop';
                rainLayer.appendChild(drop);
                const duration = isFront ? (Math.random() * 0.4 + 0.4) : (Math.random() * 0.5 + 0.8);
                const delay = Math.random() * 5;
                const horizontalPos = Math.random() * 105 - 5;
                drop.style.left = `${horizontalPos}%`;
                drop.style.animationDuration = `${duration}s`;
                drop.style.animationDelay = `${delay}s`;
                drop.style.display = 'none';
                raindrops.push(drop);
            }
        }

        function updateRainDisplay() {
            const levelConfig = RAIN_LEVELS[currentRainLevel];
            raindrops.forEach((drop, index) => { drop.style.display = index < levelConfig.count ? 'block' : 'none'; });
            rainLayer.classList.toggle('tilted-rain', levelConfig.tilt);
            levelDisplay.textContent = levelConfig.label;
            
            if(levelConfig.count > 0) {
                rainSound.volume = 0.2 + (currentRainLevel * 0.1);
                if(rainSound.paused) rainSound.play();
            } else {
                rainSound.pause();
            }
        }

        function triggerLightning() {
            if (currentRainLevel >= 4) {
                lightningFlash.classList.add('flash');
                setTimeout(() => {
                    thunderSound.currentTime = 0;
                    thunderSound.volume = 0.4;
                    thunderSound.play();
                    lightningFlash.classList.remove('flash');
                }, 500);
            }
        }

        increaseBtn.addEventListener('click', () => { if (currentRainLevel < 5) { currentRainLevel++; updateRainDisplay(); } });
        decreaseBtn.addEventListener('click', () => { if (currentRainLevel > 0) { currentRainLevel--; updateRainDisplay(); } });
        setInterval(triggerLightning, 12000); 

        const wishes = [
            "Wishing you showers of happiness and storms of success this year, Priyankaaa💫. Happy Birthday!☔🌈",
            "Happy Birthday, Priyankaaa💫 May life rain down countless moments of joy, just like the gentle drizzle that makes everything bloom.🌧️💐",
            "Priyankaaa💫, may your birthday be as magical as the sound of raindrops on a cozy day 🌧️ — calm, beautiful, and full of peace.",
            "Happy Birthday, Priyankaaa💫 Just like the rain refreshes the earth, may this year refresh your life with love, joy, and endless blessings.🌦️"
        ];
        const songs = [ 
            { title: 'Baarish', artist: 'Arijit Singh', src: './baarish.mp3' }, 
            { title: 'Khairiyat', artist: 'Arijit Singh', src: './khar.mp3' }, 
            { title: 'Ik Vaari Aa', artist: 'Arijit Singh', src: './ik.m4a' }
        ];
        let wishIndex = 0, songIndex = 0, isPlaying = false;

        const menuButtons = document.querySelectorAll('.menu-btn');
        const panels = document.querySelectorAll('.glass-panel');
        const closeButtons = document.querySelectorAll('.panel-close-btn');
        const wishesContent = document.getElementById('wishes-content');
        
        const videoPlayer = document.getElementById('video-player'); 
        
        const musicPlayer = document.getElementById('music-player');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playIcon = document.getElementById('play-icon');
        const pauseIcon = document.getElementById('pause-icon');
        const nextBtn = document.getElementById('next-btn');
        const prevBtn = document.getElementById('prev-btn');
        const trackTitle = document.querySelector('#track-info .panel-header');
        const trackArtist = document.getElementById('track-artist');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        
        function closeAllPanels() {
            panels.forEach(p => p.classList.remove('active'));
            
            const currentSrc = videoPlayer.src;
            videoPlayer.src = currentSrc; 
        }

        menuButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                if (!btn.dataset.panel) return; 
                
                const panelId = btn.dataset.panel;
                const targetPanel = document.getElementById(panelId);
                const isAlreadyActive = targetPanel.classList.contains('active');
                
                closeAllPanels();

                if (!isAlreadyActive) {
                    targetPanel.classList.add('active');
                    if (panelId === 'wishes-panel') {
                        wishesContent.textContent = wishes[wishIndex];
                        wishIndex = (wishIndex + 1) % wishes.length;
                    }
                }
            });
        });

        closeButtons.forEach(btn => btn.addEventListener('click', closeAllPanels));

        function loadSong(song) { trackTitle.textContent = song.title; trackArtist.textContent = song.artist; musicPlayer.src = song.src; }
        function playSong() { isPlaying = true; musicPlayer.play(); playIcon.style.display = 'none'; pauseIcon.style.display = 'block'; }
        function pauseSong() { isPlaying = false; musicPlayer.pause(); playIcon.style.display = 'block'; pauseIcon.style.display = 'none'; }
        playPauseBtn.addEventListener('click', () => (isPlaying ? pauseSong() : playSong()));
        nextBtn.addEventListener('click', () => { songIndex = (songIndex + 1) % songs.length; loadSong(songs[songIndex]); playSong(); });
        prevBtn.addEventListener('click', () => { songIndex = (songIndex - 1 + songs.length) % songs.length; loadSong(songs[songIndex]); playSong(); });
        musicPlayer.addEventListener('timeupdate', e => { const { duration, currentTime } = e.srcElement; progressBar.style.width = `${(currentTime / duration) * 100}%`; });
        progressContainer.addEventListener('click', e => { const width = progressContainer.clientWidth; musicPlayer.currentTime = (e.offsetX / width) * musicPlayer.duration; });
        musicPlayer.addEventListener('ended', () => { nextBtn.click(); });

        const celebrateBtn = document.getElementById('celebrate-btn');
        const rainbowBtn = document.getElementById('rainbow-btn');
        const rainbowEffect = document.getElementById('rainbow-effect');
        const fireworksSound = document.getElementById('fireworks-sound');
        const lanternColors = ['red', 'blue', 'green', 'purple', 'yellow'];

        rainbowBtn.addEventListener('click', () => rainbowEffect.classList.toggle('visible'));

        celebrateBtn.addEventListener('click', () => {
            closeAllPanels();
            fireworksSound.currentTime = 0;
            fireworksSound.play();
            confetti({ particleCount: 150, spread: 180, origin: { y: 0.6 } });
            
            const duration = 5 * 1000;
            const animationEnd = Date.now() + duration;
            const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 105 };
            
            const interval = setInterval(() => {
                if (Date.now() > animationEnd) return clearInterval(interval);
                const particleCount = 200 * (Math.random() + 0.5);
                confetti(Object.assign({}, defaults, { particleCount, origin: { x: Math.random(), y: Math.random() - 0.2 } }));
            }, 500);

            for (let i = 0; i < 7; i++) { 
                const lantern = document.createElement('div');
                const randomColor = lanternColors[Math.floor(Math.random() * lanternColors.length)];
                lantern.className = `lantern ${randomColor}`;
                lantern.style.left = `${Math.random() * 90}%`;
                lantern.style.animationDelay = `${Math.random() * 5}s`;
                lantern.style.setProperty('--x-drift', `${(Math.random() - 0.5) * 200}px`);
                document.body.appendChild(lantern);
                setTimeout(() => lantern.remove(), 20000);
            }
        });

        sceneButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                sceneButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const sceneIndex = parseInt(btn.dataset.scene, 10);
                
                backgroundScene.className = `scene scene-${sceneIndex}`;
                
                sceneTitle.textContent = sceneTitles[sceneIndex - 1];
            });
        });

        function initializeScene() {
            startOverlay.classList.add('hidden');
            mainHeading.style.visibility = 'visible';
            rainControls.style.visibility = 'visible';
            sideMenu.style.visibility = 'visible';
            sceneMenu.style.visibility = 'visible';
            
            createRainPool();
            updateRainDisplay();
            loadSong(songs[songIndex]);
            document.querySelector('.scene-btn[data-scene="1"]').classList.add('active');
        }
        
        startOverlay.addEventListener('click', initializeScene, { once: true });
    </script>
</body>
</html>